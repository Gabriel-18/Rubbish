# 事务
## 事务的概念及特性

用户自定义的一个数据库操作序列,这些操作要么全做,要么都不做,是一组不可分割的工作单位.
## ACID
特性:
- 原子性 

事务被视为不可分割的最小单元, 事务的操作要么全部提交成功, 要么全部失败回滚.

回滚可以用回滚日志来实现, 回滚日志记录着事务所执行的修改操作, 在回滚时反向执行这些修改操作即可
- 一致性

事务正确提交,就说数据库处于一致性状态.

- 隔离性

一个事务所作的修改在最终提交以前,对其他事务都是不可见的.

- 持续性

一个事务一旦提交,它所作的修改将会永远保存到数据库中.即使数据库奔溃, 事务执行的结果也不能丢失.

使用操作日志保证持久性

- 只有满足一致性,事务的执行结果才是正确的.
- 在无并发的情况下, 事务串行执行, 隔离性一定能满足.此时只要满足原子性, 就一定满足一致性.
- 在并发的情况下, 多事务并行执行, 事务不仅要满足原子性, 还要满足隔离性, 才能满足一致性.
- 事务满足持久化是为了应对数据库故障的情况.


# 数据库恢复
数据库恢复机制的功能
## 故障种类及对数据库可能造成的影响

- 事务内部的故障

有的可以通过事务程序本身发现

有的是非预期, 不能由事务程序处理

如算术溢出, 并发事务死锁而被选中撤销该事务, 违反某些完整性限制而被终止

事务故障意味着
- 事务没有达到预期的终点(COMMIT OR ROLLBACK)
- 数据库可能处于不正确状态

事务故障的恢复: **事务撤销(UNDO)**
- 强行回滚(ROLLBACK)该事务
- 撤销该事务已经作出的任何对数据库的修改, 使得该事务对象根本没有启动一样

- 系统故障

称为软故障, 是指系统停止运转的任何事件, 使得系统重新启动.

- 整个系统的正常运行突然被破坏
- 所有正在运行的事务都非正常终止
- 不破坏数据库
- 内存中数据库缓冲区的信息全部丢失

发生系统故障时, 一些尚未完成的事务的结果可能被送入物理数据库, 造成数据库可能处于不正确状态.
- 恢复策略: 系统重新启动时, 恢复程序让所有非正常终止的事务回滚, 强转撤销(UNDO)所有未完成事务

有些已完成的事务可能有一部分甚至全部留在缓冲区, 尚未写回磁盘上的物理数据库, 使得这些事务对数据库
修改部分或者全部丢失

- 恢复策略: 系统重启, 恢复程序重做(REDO)所有已提交的事务

- 介质故障

称为硬故障, 指外在故障
- 磁盘损坏
- 磁盘碰撞
- 瞬时强磁场

破坏数据库或者部分数据库, 并影响正在存取这部分数据的所有事务

发生可能性比前两者小, 但是破坏性大得多
- 计算机病毒

## 总结
- 一是数据库本身被破坏
- 二是数据库没有被破坏, 但是数据可能不正确, 这是由于事务的运行被非正常终止造成的

恢复的实现技术 （备份+日志）
# 并发控制
## 并发控制机制的功能
## 并发调度的可串行性的定义
## 封锁的概念,三级封锁协议及其可以解决的并发操作带来的不一致性问题
